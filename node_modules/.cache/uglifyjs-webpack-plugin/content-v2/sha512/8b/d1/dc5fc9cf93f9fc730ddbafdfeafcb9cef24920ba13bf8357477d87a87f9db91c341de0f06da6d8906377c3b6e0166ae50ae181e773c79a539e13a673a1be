{"code":"!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"/\",i(i.s=3)}({3:function(t,e,i){\"use strict\";i.r(e);Function.prototype.bind=Function.prototype.bind||function(t){var e=this;return function(i){i instanceof Array||(i=[i]),e.apply(t,i)}},function(){if(!(void 0===window.Element||\"classList\"in document.documentElement)){var t=Array.prototype,e=t.push,i=t.splice,n=t.join;o.prototype={add:function(t){this.contains(t)||(e.call(this,t),this.el.className=this.toString())},contains:function(t){return-1!=this.el.className.indexOf(t)},item:function(t){return this[t]||null},remove:function(t){if(this.contains(t)){for(var e=0;e<this.length&&this[e]!=t;e++);i.call(this,e,1),this.el.className=this.toString()}},toString:function(){return n.call(this,\" \")},toggle:function(t){return this.contains(t)?this.remove(t):this.add(t),this.contains(t)}},window.DOMTokenList=o,function(t,e,i){Object.defineProperty?Object.defineProperty(t,e,{get:i}):t.__defineGetter__(e,i)}(HTMLElement.prototype,\"classList\",function(){return new o(this)})}function o(t){this.el=t;for(var i=t.className.replace(/^\\s+|\\s+$/g,\"\").split(/\\s+/),n=0;n<i.length;n++)e.call(this,i[n])}}(),function(){for(var t=0,e=[\"webkit\",\"moz\"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+\"RequestAnimationFrame\"],window.cancelAnimationFrame=window[e[i]+\"CancelAnimationFrame\"]||window[e[i]+\"CancelRequestAnimationFrame\"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),o=window.setTimeout(function(){e(i+n)},n);return t=i+n,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();function n(t,e){this.x=t.x,this.y=t.y,this.value=e||2,this.previousPosition=null,this.mergedFrom=null}n.prototype.savePosition=function(){this.previousPosition={x:this.x,y:this.y}},n.prototype.updatePosition=function(t){this.x=t.x,this.y=t.y},n.prototype.serialize=function(){return{position:{x:this.x,y:this.y},value:this.value}};var o=n;function r(t,e){this.size=t,this.cells=e?this.fromState(e):this.empty()}r.prototype.empty=function(){for(var t=[],e=0;e<this.size;e++)for(var i=t[e]=[],n=0;n<this.size;n++)i.push(null);return t},r.prototype.fromState=function(t){for(var e=[],i=0;i<this.size;i++)for(var n=e[i]=[],r=0;r<this.size;r++){var s=t[i][r];n.push(s?new o(s.position,s.value):null)}return e},r.prototype.randomAvailableCell=function(){var t=this.availableCells();if(t.length)return t[Math.floor(Math.random()*t.length)]},r.prototype.availableCells=function(){var t=[];return this.eachCell(function(e,i,n){n||t.push({x:e,y:i})}),t},r.prototype.eachCell=function(t){for(var e=0;e<this.size;e++)for(var i=0;i<this.size;i++)t(e,i,this.cells[e][i])},r.prototype.cellsAvailable=function(){return!!this.availableCells().length},r.prototype.cellAvailable=function(t){return!this.cellOccupied(t)},r.prototype.cellOccupied=function(t){return!!this.cellContent(t)},r.prototype.cellContent=function(t){return this.withinBounds(t)?this.cells[t.x][t.y]:null},r.prototype.insertTile=function(t){this.cells[t.x][t.y]=t},r.prototype.removeTile=function(t){this.cells[t.x][t.y]=null},r.prototype.withinBounds=function(t){return t.x>=0&&t.x<this.size&&t.y>=0&&t.y<this.size},r.prototype.serialize=function(){for(var t=[],e=0;e<this.size;e++)for(var i=t[e]=[],n=0;n<this.size;n++)i.push(this.cells[e][n]?this.cells[e][n].serialize():null);return{size:this.size,cells:t}};var s=r;function a(){this.bestScoreKey=\"bestScore\",this.gameStateKey=\"gameState\";var t=this.localStorageSupported();this.storage=t?window.localStorage:window.fakeStorage}window.fakeStorage={_data:{},setItem:function(t,e){return this._data[t]=String(e)},getItem:function(t){return this._data.hasOwnProperty(t)?this._data[t]:void 0},removeItem:function(t){return delete this._data[t]},clear:function(){return this._data={}}},a.prototype.localStorageSupported=function(){try{var t=window.localStorage;return t.setItem(\"test\",\"1\"),t.removeItem(\"test\"),!0}catch(t){return!1}},a.prototype.getBestScore=function(){return this.storage.getItem(this.bestScoreKey)||0},a.prototype.setBestScore=function(t){this.storage.setItem(this.bestScoreKey,t)},a.prototype.getGameState=function(){var t=this.storage.getItem(this.gameStateKey);return t?JSON.parse(t):null},a.prototype.setGameState=function(t){this.storage.setItem(this.gameStateKey,JSON.stringify(t))},a.prototype.clearGameState=function(){this.storage.removeItem(this.gameStateKey)};var l=a;function c(t,e,i,n){this.size=t,this.inputManager=new e,this.storageManager=new n,this.actuator=new i,this.startTiles=2,this.inputManager.on(\"move\",this.move.bind(this)),this.inputManager.on(\"restart\",this.restart.bind(this)),this.inputManager.on(\"keepPlaying\",this.keepPlaying.bind(this)),this.setup()}c.prototype.restart=function(){this.storageManager.clearGameState(),this.actuator.continueGame(),this.setup()},c.prototype.keepPlaying=function(){this.keepPlaying=!0,this.actuator.continueGame()},c.prototype.isGameTerminated=function(){return this.over||this.won&&!this.keepPlaying},c.prototype.setup=function(){var t=this.storageManager.getGameState();t?(this.grid=new s(t.grid.size,t.grid.cells),this.score=t.score,this.over=t.over,this.won=t.won,this.keepPlaying=t.keepPlaying):(this.grid=new s(this.size),this.score=0,this.over=!1,this.won=!1,this.keepPlaying=!1,this.addStartTiles()),this.actuate()},c.prototype.addStartTiles=function(){for(var t=0;t<this.startTiles;t++)this.addRandomTile()},c.prototype.addRandomTile=function(){if(this.grid.cellsAvailable()){var t=Math.random()<.9?2:4,e=new o(this.grid.randomAvailableCell(),t);this.grid.insertTile(e)}},c.prototype.actuate=function(){this.storageManager.getBestScore()<this.score&&this.storageManager.setBestScore(this.score),this.over?this.storageManager.clearGameState():this.storageManager.setGameState(this.serialize()),this.actuator.actuate(this.grid,{score:this.score,over:this.over,won:this.won,bestScore:this.storageManager.getBestScore(),terminated:this.isGameTerminated()})},c.prototype.serialize=function(){return{grid:this.grid.serialize(),score:this.score,over:this.over,won:this.won,keepPlaying:this.keepPlaying}},c.prototype.prepareTiles=function(){this.grid.eachCell(function(t,e,i){i&&(i.mergedFrom=null,i.savePosition())})},c.prototype.moveTile=function(t,e){this.grid.cells[t.x][t.y]=null,this.grid.cells[e.x][e.y]=t,t.updatePosition(e)},c.prototype.move=function(t){var e=this;if(!this.isGameTerminated()){var i,n,r=this.getVector(t),s=this.buildTraversals(r),a=!1;this.prepareTiles(),s.x.forEach(function(t){s.y.forEach(function(s){if(i={x:t,y:s},n=e.grid.cellContent(i)){var l=e.findFarthestPosition(i,r),c=e.grid.cellContent(l.next);if(c&&c.value===n.value&&!c.mergedFrom){var u=new o(l.next,2*n.value);u.mergedFrom=[n,c],e.grid.insertTile(u),e.grid.removeTile(n),n.updatePosition(l.next),e.score+=u.value,2048===u.value&&(e.won=!0)}else e.moveTile(n,l.farthest);e.positionsEqual(i,n)||(a=!0)}})}),a&&(this.addRandomTile(),this.movesAvailable()||(this.over=!0),this.actuate())}},c.prototype.getVector=function(t){return{0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}}[t]},c.prototype.buildTraversals=function(t){for(var e={x:[],y:[]},i=0;i<this.size;i++)e.x.push(i),e.y.push(i);return 1===t.x&&(e.x=e.x.reverse()),1===t.y&&(e.y=e.y.reverse()),e},c.prototype.findFarthestPosition=function(t,e){var i;do{t={x:(i=t).x+e.x,y:i.y+e.y}}while(this.grid.withinBounds(t)&&this.grid.cellAvailable(t));return{farthest:i,next:t}},c.prototype.movesAvailable=function(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()},c.prototype.tileMatchesAvailable=function(){for(var t,e=0;e<this.size;e++)for(var i=0;i<this.size;i++)if(t=this.grid.cellContent({x:e,y:i}))for(var n=0;n<4;n++){var o=this.getVector(n),r={x:e+o.x,y:i+o.y},s=this.grid.cellContent(r);if(s&&s.value===t.value)return!0}return!1},c.prototype.positionsEqual=function(t,e){return t.x===e.x&&t.y===e.y};var u=c;function h(){this.events={},window.navigator.msPointerEnabled?(this.eventTouchstart=\"MSPointerDown\",this.eventTouchmove=\"MSPointerMove\",this.eventTouchend=\"MSPointerUp\"):(this.eventTouchstart=\"touchstart\",this.eventTouchmove=\"touchmove\",this.eventTouchend=\"touchend\"),this.listen()}h.prototype.on=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},h.prototype.emit=function(t,e){var i=this.events[t];i&&i.forEach(function(t){t(e)})},h.prototype.listen=function(){var t,e,i=this,n={38:0,39:1,40:2,37:3,75:0,76:1,74:2,72:3,87:0,68:1,83:2,65:3};document.addEventListener(\"keydown\",function(t){var e=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey,o=n[t.which];e||void 0!==o&&(t.preventDefault(),i.emit(\"move\",o)),e||82!==t.which||i.restart.call(i,t)}),this.bindButtonPress(\".retry-button\",this.restart),this.bindButtonPress(\".restart-button\",this.restart),this.bindButtonPress(\".keep-playing-button\",this.keepPlaying);var o=document.getElementsByClassName(\"game-container\")[0];o.addEventListener(this.eventTouchstart,function(i){!window.navigator.msPointerEnabled&&i.touches.length>1||i.targetTouches.length>1||(window.navigator.msPointerEnabled?(t=i.pageX,e=i.pageY):(t=i.touches[0].clientX,e=i.touches[0].clientY),i.preventDefault())}),o.addEventListener(this.eventTouchmove,function(t){t.preventDefault()}),o.addEventListener(this.eventTouchend,function(n){if(!(!window.navigator.msPointerEnabled&&n.touches.length>0||n.targetTouches.length>0)){var o,r;window.navigator.msPointerEnabled?(o=n.pageX,r=n.pageY):(o=n.changedTouches[0].clientX,r=n.changedTouches[0].clientY);var s=o-t,a=Math.abs(s),l=r-e,c=Math.abs(l);Math.max(a,c)>10&&i.emit(\"move\",a>c?s>0?1:3:l>0?2:0)}})},h.prototype.restart=function(t){t.preventDefault(),this.emit(\"restart\")},h.prototype.keepPlaying=function(t){t.preventDefault(),this.emit(\"keepPlaying\")},h.prototype.bindButtonPress=function(t,e){var i=document.querySelector(t);i.addEventListener(\"click\",e.bind(this)),i.addEventListener(this.eventTouchend,e.bind(this))};var p=h;function d(){this.tileContainer=document.querySelector(\".tile-container\"),this.scoreContainer=document.querySelector(\".score-container\"),this.bestContainer=document.querySelector(\".best-container\"),this.messageContainer=document.querySelector(\".game-message\"),this.score=0}d.prototype.actuate=function(t,e){var i=this;window.requestAnimationFrame(function(){i.clearContainer(i.tileContainer),t.cells.forEach(function(t){t.forEach(function(t){t&&i.addTile(t)})}),i.updateScore(e.score),i.updateBestScore(e.bestScore),e.terminated&&(e.over?i.message(!1):e.won&&i.message(!0))})},d.prototype.continueGame=function(){this.clearMessage()},d.prototype.clearContainer=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},d.prototype.addTile=function(t){var e=this,i=document.createElement(\"div\"),n=document.createElement(\"div\"),o=t.previousPosition||{x:t.x,y:t.y},r=this.positionClass(o),s=[\"tile\",\"tile-\"+t.value,r];t.value>2048&&s.push(\"tile-super\"),this.applyClasses(i,s),n.classList.add(\"tile-inner\"),n.textContent=t.value,t.previousPosition?window.requestAnimationFrame(function(){s[2]=e.positionClass({x:t.x,y:t.y}),e.applyClasses(i,s)}):t.mergedFrom?(s.push(\"tile-merged\"),this.applyClasses(i,s),t.mergedFrom.forEach(function(t){e.addTile(t)})):(s.push(\"tile-new\"),this.applyClasses(i,s)),i.appendChild(n),this.tileContainer.appendChild(i)},d.prototype.applyClasses=function(t,e){t.setAttribute(\"class\",e.join(\" \"))},d.prototype.normalizePosition=function(t){return{x:t.x+1,y:t.y+1}},d.prototype.positionClass=function(t){return\"tile-position-\"+(t=this.normalizePosition(t)).x+\"-\"+t.y},d.prototype.updateScore=function(t){this.clearContainer(this.scoreContainer);var e=t-this.score;if(this.score=t,this.scoreContainer.textContent=this.score,e>0){var i=document.createElement(\"div\");i.classList.add(\"score-addition\"),i.textContent=\"+\"+e,this.scoreContainer.appendChild(i)}},d.prototype.updateBestScore=function(t){this.bestContainer.textContent=t},d.prototype.message=function(t){var e=t?\"game-won\":\"game-over\",i=t?\"You win!\":\"Game over!\";this.messageContainer.classList.add(e),this.messageContainer.getElementsByTagName(\"p\")[0].textContent=i},d.prototype.clearMessage=function(){this.messageContainer.classList.remove(\"game-won\"),this.messageContainer.classList.remove(\"game-over\")};var f=d;window.requestAnimationFrame(function(){new u(4,p,f,l)})}});","extractedComments":[]}